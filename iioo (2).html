<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>HOMOS Learn â€” ÙƒÙˆØ±Ø³ Ø´Ø§Ù…Ù„ Ù„ØªØ¹Ù„Ù‘Ù… Ø§Ù„Ø£Ù„Ù…Ø§Ù†ÙŠØ© (Ø¨Ø¯ÙˆÙ† Ø³ÙŠØ±ÙØ±)</title>
  <link rel="stylesheet" href="style.css">
<style type="text/css" id="dcoder_stylesheet">:root{
  --green:#007a3d;
  --green-dark:#005e2e;
  --bg:#f5f7f6;
  --card:#ffffff;
  --muted:#6b6b6b;
  --glass:rgba(0,0,0,0.04);
  --accent:#0b4b28;
}

*{box-sizing:border-box}
html,body{height:100%;margin:0;padding:0;font-family:"Cairo",sans-serif;background:var(--bg);color:#222}
.topbar{
  background:linear-gradient(90deg,var(--green),var(--green-dark));
  color:white;padding:12px 18px;display:flex;justify-content:space-between;align-items:center;gap:12px;
}
.brand{display:flex;align-items:center;gap:10px}
.logo{font-size:22px}
.title{font-weight:700;font-size:18px}
.right-actions .btn{margin-left:8px}

.layout{display:flex;gap:18px;max-width:1200px;margin:18px auto;padding:0 12px;width:100%}
.sidebar{flex:0 0 320px;background:var(--card);border-radius:12px;padding:14px;box-shadow:0 6px 18px rgba(0,0,0,0.06);height:calc(100vh - 120px);overflow:auto}
.content{flex:1;display:flex;flex-direction:column;gap:16px}

.module-list{display:flex;flex-direction:column;gap:8px;margin-bottom:12px}
.module-item{padding:8px;border-radius:8px;cursor:pointer;background:var(--glass);display:flex;justify-content:space-between;align-items:center}
.module-item.active{background:linear-gradient(90deg,#e6f8ef,#d6f7e6);border:1px solid rgba(0,122,61,0.12)}

.lesson-list{list-style:none;padding:0;margin:8px 0;max-height:40vh;overflow:auto}
.lesson-list li{padding:10px;border-radius:8px;margin-bottom:8px;cursor:pointer;background:var(--glass);display:flex;justify-content:space-between;align-items:center}
.lesson-list li.active{background:linear-gradient(90deg,#f1fff6,#eefef4);border:1px solid rgba(0,0,0,0.04)}
.lesson-list li .title-small{font-weight:700;color:var(--accent);direction:rtl}
.lesson-list li .meta{font-size:12px;color:var(--muted)}

.controls{margin-top:12px;display:flex;flex-direction:column;gap:8px}
.btn{border:none;padding:10px;border-radius:10px;cursor:pointer;font-weight:700}
.btn.green{background:var(--green);color:white}
.btn.ghost{background:transparent;border:1px solid rgba(0,0,0,0.06);color:#333}
.btn:hover{filter:brightness(0.98)}

.voice-status{margin-top:12px;font-size:13px;color:var(--muted);white-space:pre-line}
.progress-summary{margin-top:12px;font-size:13px;color:var(--muted)}

.card{background:var(--card);padding:18px;border-radius:12px;box-shadow:0 8px 30px rgba(0,0,0,0.04)}
.muted{color:var(--muted);margin-top:6px}

.items{display:flex;flex-direction:column;gap:10px;margin-top:12px}
.item{border-radius:10px;padding:12px;background:linear-gradient(180deg,#ffffff,#f8fffb);display:flex;align-items:center;justify-content:space-between;gap:10px;border:1px solid rgba(0,0,0,0.03)}
.item .left{display:flex;flex-direction:column;align-items:flex-end;gap:6px;text-align:right}
.item .de{font-weight:800;font-size:18px;color:var(--accent)}
.item .ar{color:var(--muted);font-size:14px}
.item .controls{display:flex;gap:8px;align-items:center}

.play-btn{background:var(--green);color:white;border:none;padding:8px 10px;border-radius:8px;cursor:pointer}
.play-btn.small{padding:6px 8px;font-size:14px}
.record-btn{background:#e86b4d;color:white;padding:8px;border-radius:8px;border:none;cursor:pointer}

.completed-badge{background:#e6f8ef;color:#006b2f;padding:6px 8px;border-radius:8px;font-weight:700;font-size:13px}

.nav-row{display:flex;justify-content:space-between;margin-top:16px;gap:12px}
.lesson-actions{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap}

.message{min-height:28px;color:var(--muted);padding:6px 4px}

.footer{text-align:center;margin:28px 0;color:var(--muted);font-size:13px}

/* modal */
.modal{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:flex;justify-content:center;align-items:center;z-index:60;visibility:hidden;opacity:0;transition:opacity .18s}
.modal[aria-hidden="false"]{visibility:visible;opacity:1}
.modal-content{background:white;padding:18px;border-radius:12px;min-width:320px;max-width:720px}
.modal-actions{display:flex;justify-content:flex-end;gap:8px;margin-top:12px}

/* responsive */
@media(max-width:900px){
  .layout{flex-direction:column;padding:8px}
  .sidebar{order:2;flex:unset;height:auto}
  .content{order:1}
}</style></head>
<body>
  <header class="topbar">
    <div class="brand">
      <span class="logo">ğŸ“˜</span>
      <span class="title">HOMOS Learn â€” Ø§Ù„Ø£Ù„Ù…Ø§Ù†ÙŠØ© Ø­ØªÙ‰ Ø§Ù„Ø³ÙØ±</span>
    </div>
    <div class="right-actions">
      <button id="exportBtn" class="btn ghost">ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø¯Ù‘Ù…</button>
      <button id="importBtn" class="btn ghost">Ø§Ø³ØªÙŠØ±Ø§Ø¯ ØªÙ‚Ø¯Ù‘Ù…</button>
    </div>
  </header>

  <main class="layout">
    <aside class="sidebar">
      <h3>Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª</h3>
      <div id="moduleList" class="module-list"></div>

      <hr>

      <h4>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø±ÙˆØ³</h4>
      <ul id="lessonList" class="lesson-list" aria-label="Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø±ÙˆØ³"></ul>

      <div class="controls">
        <button id="reviewWrongBtn" class="btn">Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ ğŸ”</button>
        <button id="resetBtn" class="btn ghost">Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„ØªÙ‚Ø¯Ù‘Ù… â™»ï¸</button>
      </div>

      <div class="voice-status" id="voiceStatus">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ø¶ÙŠØ± Ù„Ù„Ù†Ø·Ù‚...</div>
      <div class="progress-summary" id="progressSummary">â€”</div>
    </aside>

    <section class="content">
      <div id="lessonCard" class="card">
        <h2 id="lessonTitle">Ø§Ø®ØªØ± Ø¯Ø±Ø³Ø§Ù‹ Ù…Ù† Ø§Ù„ÙŠØ³Ø§Ø±</h2>
        <p id="lessonDesc" class="muted"></p>

        <div id="itemsContainer" class="items"></div>

        <div class="nav-row">
          <button id="prevBtn" class="btn ghost">Ø§Ù„Ø³Ø§Ø¨Ù‚ â—€ï¸</button>
          <button id="playAllBtn" class="btn">ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¯Ø±Ø³ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ ğŸ”Š</button>
          <button id="nextBtn" class="btn">Ø§Ù„ØªØ§Ù„ÙŠ â–¶ï¸</button>
        </div>

        <div class="lesson-actions">
          <button id="markCompleteBtn" class="btn green">ÙˆØ¶Ø¹ Ø¹Ù„Ø§Ù…Ø© Ù…ÙƒØªÙ…Ù„ âœ…</button>
          <button id="quizBtn" class="btn">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¯Ø±Ø³ âœï¸</button>
        </div>
      </div>

      <div id="message" class="message" role="status" aria-live="polite"></div>
    </section>
  </main>

  <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± -->
  <div id="quizModal" class="modal" aria-hidden="true">
    <div class="modal-content">
      <h3 id="quizTitle">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¯Ø±Ø³</h3>
      <div id="quizArea"></div>
      <div class="modal-actions">
        <button id="closeQuiz" class="btn ghost">Ø¥ØºÙ„Ø§Ù‚</button>
        <button id="startQuiz" class="btn green">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
      </div>
    </div>
  </div>

  <!-- Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù„Ù -->
  <input type="file" id="importFile" accept=".json" style="display:none">

  <footer class="footer">
    <small>Ù†Ø³Ø®Ø© Ù…Ø­Ù„ÙŠØ© ØªØ¬Ø±ÙŠØ¨ÙŠØ© â€” HOMOS Learn Â© 2025 â€” ÙŠØ¹Ù…Ù„ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…ØªØµÙØ­</small>
  </footer>

  <script src="app.js"></script>

<script type="text/javascript" id="dcoder_script">/* app.js
   ÙƒÙˆØ±Ø³ Ù…Ø­Ù„ÙŠ ÙƒØ§Ù…Ù„ (Ø¨Ø¯ÙˆÙ† Ø³ÙŠØ±ÙØ±) â€” Ø¯Ø±ÙˆØ³ØŒ Ù†Ø·Ù‚ Ø¢Ù…Ù†ØŒ Ø§Ø®ØªØ¨Ø§Ø±Ø§ØªØŒ Ø­ÙØ¸ ØªÙ‚Ø¯Ù‘Ù…ØŒ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø£Ø®Ø·Ø§Ø¡.
*/

document.addEventListener("DOMContentLoaded", () => {
  // Ø¹Ù†Ø§ØµØ± DOM
  const moduleListEl = document.getElementById("moduleList");
  const lessonListEl = document.getElementById("lessonList");
  const lessonTitleEl = document.getElementById("lessonTitle");
  const lessonDescEl = document.getElementById("lessonDesc");
  const itemsContainerEl = document.getElementById("itemsContainer");
  const prevBtn = document.getElementById("prevBtn");
  const nextBtn = document.getElementById("nextBtn");
  const playAllBtn = document.getElementById("playAllBtn");
  const markCompleteBtn = document.getElementById("markCompleteBtn");
  const quizBtn = document.getElementById("quizBtn");
  const reviewWrongBtn = document.getElementById("reviewWrongBtn");
  const resetBtn = document.getElementById("resetBtn");
  const voiceStatusEl = document.getElementById("voiceStatus");
  const progressSummaryEl = document.getElementById("progressSummary");
  const messageEl = document.getElementById("message");
  const quizModal = document.getElementById("quizModal");
  const quizArea = document.getElementById("quizArea");
  const startQuizBtn = document.getElementById("startQuiz");
  const closeQuizBtn = document.getElementById("closeQuiz");
  const exportBtn = document.getElementById("exportBtn");
  const importBtn = document.getElementById("importBtn");
  const importFile = document.getElementById("importFile");

  // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª ÙˆØ§Ù„Ø¯Ø±ÙˆØ³ (Ù…Ø­Ù„ÙŠ)
  // ÙƒÙ„ module ÙŠÙ…Ù„Ùƒ lessonsØŒ ÙˆÙƒÙ„ Ø¯Ø±Ø³ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ items {de, ar, note?}
  const modules = [
    {
      id: "basics",
      title: "Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ§Øª (A1)",
      lessons: [
        {
          id: "pronouns",
          title: "Ø§Ù„Ø¶Ù…Ø§Ø¦Ø± Ø§Ù„Ø´Ø®ØµÙŠØ©",
          desc: "Ich, Du, Er, Sie, Wir, Ihr, Sie (ØµÙŠØºØ© Ø§Ù„Ø§Ø­ØªØ±Ø§Ù…).",
          items: [
            { de: "Ich", ar: "Ø£Ù†Ø§" },
            { de: "Du", ar: "Ø£Ù†Øª (Ù…ÙØ±Ø¯ ØºÙŠØ± Ø±Ø³Ù…ÙŠ)" },
            { de: "Er", ar: "Ù‡Ùˆ" },
            { de: "Sie", ar: "Ù‡ÙŠ" },
            { de: "Wir", ar: "Ù†Ø­Ù†" },
            { de: "Ihr", ar: "Ø£Ù†ØªÙ… (ØºÙŠØ± Ø±Ø³Ù…ÙŠ)" },
            { de: "Sie", ar: "Ø­Ø¶Ø±ØªÙƒ/Ù‡Ù… (ØµÙŠØºØ© Ø§Ù„Ø§Ø­ØªØ±Ø§Ù…)" }
          ]
        },
        {
          id: "basic-verbs",
          title: "Ø£ÙØ¹Ø§Ù„ Ø£Ø³Ø§Ø³ÙŠØ©",
          desc: "Ø£ÙØ¹Ø§Ù„ ÙŠÙˆÙ…ÙŠØ© Ø¨Ø³ÙŠØ·Ø© ÙˆØµÙŠØºÙ‡Ø§ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©.",
          items: [
            { de: "sein", ar: "ÙŠÙƒÙˆÙ† / Ø£ÙƒÙˆÙ†" },
            { de: "haben", ar: "ÙŠÙ…Ù„Ùƒ / Ù„Ø¯ÙŠ" },
            { de: "gehen", ar: "ÙŠØ°Ù‡Ø¨" },
            { de: "kommen", ar: "ÙŠØ£ØªÙŠ" },
            { de: "sprechen", ar: "ÙŠØªÙƒÙ„Ù…" },
            { de: "essen", ar: "ÙŠØ£ÙƒÙ„" },
            { de: "trinken", ar: "ÙŠØ´Ø±Ø¨" }
          ]
        },
        {
          id: "greetings",
          title: "Ø§Ù„ØªØ­ÙŠØ§Øª ÙˆØ§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©",
          desc: "Ø¹Ø¨Ø§Ø±Ø§Øª ØªØ³ØªØ®Ø¯Ù… ÙŠÙˆÙ…ÙŠÙ‹Ø§ (Ø§Ù„ØªØ­ÙŠØ§ØªØŒ Ø§Ù„Ø´ÙƒØ±ØŒ Ø§Ù„Ø§Ø¹ØªØ°Ø§Ø±Ø§Øª).",
          items: [
            { de: "Guten Morgen", ar: "ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ±" },
            { de: "Guten Abend", ar: "Ù…Ø³Ø§Ø¡ Ø§Ù„Ø®ÙŠØ±" },
            { de: "Guten Tag", ar: "Ù†Ù‡Ø§Ø±Ùƒ Ø³Ø¹ÙŠØ¯" },
            { de: "TschÃ¼ss", ar: "Ù…Ø¹ Ø§Ù„Ø³Ù„Ø§Ù…Ø© (ØºÙŠØ± Ø±Ø³Ù…ÙŠ)" },
            { de: "Auf Wiedersehen", ar: "Ø¥Ù„Ù‰ Ø§Ù„Ù„Ù‚Ø§Ø¡ (Ø±Ø³Ù…ÙŠ)" },
            { de: "Danke", ar: "Ø´ÙƒØ±Ø§Ù‹" },
            { de: "Bitte", ar: "Ù…Ù† ÙØ¶Ù„Ùƒ / Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø­Ø¨ ÙˆØ§Ù„Ø³Ø¹Ø©" }
          ]
        }
      ]
    },

    {
      id: "travel",
      title: "Ø­ÙŠØ§Ø© ÙŠÙˆÙ…ÙŠØ© Ùˆ Ø³ÙØ±",
      lessons: [
        {
          id: "airport",
          title: "ÙÙŠ Ø§Ù„Ù…Ø·Ø§Ø±",
          desc: "Ø¹Ø¨Ø§Ø±Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ© ÙÙŠ Ø§Ù„Ù…Ø·Ø§Ø±: Ø³Ø¤Ø§Ù„ Ø§Ù„Ø§Ø³Ù…ØŒ Ø§Ù„Ø¬ÙˆØ§Ø²ØŒ Ø§Ù„ØªØ°Ø§ÙƒØ±.",
          items: [
            { de: "Wie heiÃŸen Sie?", ar: "Ù…Ø§ Ø§Ø³Ù…ÙƒØŸ (Ø±Ø³Ù…ÙŠ)" },
            { de: "Ich heiÃŸe ...", ar: "Ø§Ø³Ù…ÙŠ ..." },
            { de: "Wo ist der Ausgang?", ar: "Ø£ÙŠÙ† Ø§Ù„Ù…Ø®Ø±Ø¬ØŸ" },
            { de: "Ich habe mein Ticket.", ar: "Ù„Ø¯ÙŠ ØªØ°ÙƒØ±ØªÙŠ." },
            { de: "Darf ich Ihren Pass sehen?", ar: "Ù‡Ù„ Ø£Ø³ØªØ·ÙŠØ¹ Ø±Ø¤ÙŠØ© Ø¬ÙˆØ§Ø²ÙƒØŸ" }
          ]
        },
        {
          id: "hotel",
          title: "Ø§Ù„Ø­Ø¬Ø² ÙÙŠ Ø§Ù„ÙÙ†Ø¯Ù‚",
          desc: "Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„: Ø­Ø¬Ø²ØŒ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ÙˆØµÙˆÙ„ØŒ Ø·Ù„Ø¨ Ù…ÙØ§ØªÙŠØ­.",
          items: [
            { de: "Ich habe eine Reservierung.", ar: "Ù„Ø¯ÙŠ Ø­Ø¬Ø²." },
            { de: "Ich mÃ¶chte einchecken.", ar: "Ø£Ø±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ (check-in)." },
            { de: "KÃ¶nnen Sie mir das Passwort fÃ¼r WLAN geben?", ar: "Ù‡Ù„ ÙŠÙ…ÙƒÙ† Ø£Ù† ØªØ¹Ø·ÙŠÙ†ÙŠ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„ÙˆØ§ÙŠ ÙØ§ÙŠØŸ" }
          ]
        }
      ]
    },

    {
      id: "admin",
      title: "Ø§Ù„Ø£ÙˆØ±Ø§Ù‚ ÙˆØ¯ÙˆØ§Ø¦Ø± Ø­ÙƒÙˆÙ…ÙŠØ©",
      lessons: [
        {
          id: "anmeldung",
          title: "Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Ø§Ù„Ø¨Ù„Ø¯ÙŠØ© (Anmeldung)",
          desc: "Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø³ÙƒÙ†.",
          items: [
            { de: "Meldebescheinigung", ar: "Ø¥Ø«Ø¨Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„" },
            { de: "WohnungsgeberbestÃ¤tigung", ar: "ØªØ£ÙƒÙŠØ¯ ØµØ§Ø­Ø¨ Ø§Ù„Ø³ÙƒÙ†" },
            { de: "Ich mÃ¶chte mich anmelden.", ar: "Ø£Ø±ÙŠØ¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„." }
          ]
        },
        {
          id: "bank",
          title: "ÙØªØ­ Ø­Ø³Ø§Ø¨ Ø¨Ù†ÙƒÙŠ",
          desc: "Ù…ØµØ·Ù„Ø­Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„Ø°Ù‡Ø§Ø¨ Ù„Ù„Ø¨Ù†Ùƒ.",
          items: [
            { de: "Ich mÃ¶chte ein Konto erÃ¶ffnen.", ar: "Ø£Ø±ÙŠØ¯ ÙØªØ­ Ø­Ø³Ø§Ø¨." },
            { de: "Kontostand", ar: "Ø±ØµÙŠØ¯ Ø§Ù„Ø­Ø³Ø§Ø¨" },
            { de: "EC-Karte", ar: "Ø¨Ø·Ø§Ù‚Ø© Ø¨Ù†ÙƒÙŠØ©" }
          ]
        }
      ]
    },

    {
      id: "work",
      title: "Ø§Ù„Ø¹Ù…Ù„ ÙˆØ§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ©",
      lessons: [
        {
          id: "cv",
          title: "ÙƒØªØ§Ø¨Ø© Ø³ÙŠØ±Ø© Ø°Ø§ØªÙŠØ© Ø¨Ø³ÙŠØ·Ø©",
          desc: "Ø¹Ø¨Ø§Ø±Ø§Øª ØªÙØ³ØªØ®Ø¯Ù… ÙÙŠ Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ© ÙˆØ±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªÙ‚Ø¯ÙŠÙ….",
          items: [
            { de: "Lebenslauf", ar: "Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ©" },
            { de: "Berufserfahrung", ar: "Ø§Ù„Ø®Ø¨Ø±Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ©" },
            { de: "Bewerbung", ar: "Ø§Ù„ØªÙ‚Ø¯ÙŠÙ… Ø¹Ù„Ù‰ ÙˆØ¸ÙŠÙØ©" }
          ]
        },
        {
          id: "interview",
          title: "Ù…Ù‚Ø§Ø¨Ù„Ø© Ø§Ù„Ø¹Ù…Ù„",
          desc: "Ø£Ø³Ø¦Ù„Ø© ÙˆØ¥Ø¬Ø§Ø¨Ø§Øª Ø¨Ø³ÙŠØ·Ø© Ù„Ù„Ù…Ù‚Ø§Ø¨Ù„Ø§Øª.",
          items: [
            { de: "Warum mÃ¶chten Sie hier arbeiten?", ar: "Ù„Ù…Ø§Ø°Ø§ ØªØ±ÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„ Ù‡Ù†Ø§ØŸ" },
            { de: "Ich habe Erfahrung in ...", ar: "Ù„Ø¯ÙŠ Ø®Ø¨Ø±Ø© ÙÙŠ ..." },
            { de: "Wann kÃ¶nnen Sie anfangen?", ar: "Ù…ØªÙ‰ ØªØ³ØªØ·ÙŠØ¹ Ø§Ù„Ø¨Ø¯Ø¡ØŸ" }
          ]
        }
      ]
    },

    {
      id: "health",
      title: "Ø§Ù„ØµØ­Ø© ÙˆØ§Ù„ØªØ£Ù…ÙŠÙ†",
      lessons: [
        {
          id: "doctor",
          title: "Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ø·Ø¨ÙŠØ¨",
          desc: "Ø¹Ø¨Ø§Ø±Ø§Øª Ø¹Ù†Ø¯ Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ø·Ø¨ÙŠØ¨ Ø£Ùˆ Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ©.",
          items: [
            { de: "Ich habe Bauchschmerzen.", ar: "Ø£Ø¹Ø§Ù†ÙŠ Ù…Ù† Ø£Ù„Ù… ÙÙŠ Ø§Ù„Ø¨Ø·Ù†." },
            { de: "Haben Sie Allergien?", ar: "Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø³ÙŠØ©ØŸ" },
            { de: "Ich brauche einen Termin.", ar: "Ø£Ø­ØªØ§Ø¬ Ù„Ù…ÙˆØ¹Ø¯." }
          ]
        }
      ]
    }
  ];

  // Ø§Ù„Ø­Ø§Ù„Ø©
  let currentModuleIdx = 0;
  let currentLessonIdx = 0;
  let currentItemIdx = 0;
  const STORAGE_KEY = "homos_learn_v2_progress";
  let progress = loadProgress(); // { completed: {lessonId: true}, wrong: [], last: {moduleIdx, lessonIdx, itemIdx} }

  // Ø¥Ø¹Ø¯Ø§Ø¯ TTS: Ù†Ø¨Ø­Ø« Ø¹Ù† ØµÙˆØª Ø£Ù„Ù…Ø§Ù†ÙŠ Ù…ØªØ§Ø­
  let germanVoice = null;
  function findGermanVoice() {
    if (!("speechSynthesis" in window)) {
      voiceStatusEl.textContent = "Ù…ÙŠØ²Ø© Ø§Ù„Ù†Ø·Ù‚ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­.";
      return;
    }
    const voices = speechSynthesis.getVoices();
    germanVoice = voices.find(v => (v.lang && v.lang.toLowerCase().startsWith("de")) || (v.name && /german/i.test(v.name)));
    if (germanVoice) voiceStatusEl.textContent = `ØµÙˆØª Ø£Ù„Ù…Ø§Ù†ÙŠ Ø¬Ø§Ù‡Ø²: ${germanVoice.name}`;
    else voiceStatusEl.textContent = "Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØµÙˆØª Ø£Ù„Ù…Ø§Ù†ÙŠ Ù…Ø®ØµÙ‘ØµØ› Ø³ÙŠÙØ³ØªØ®Ø¯Ù… ØµÙˆØª Ø§Ù„Ù…ØªØµÙØ­ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ.";
  }
  if ("speechSynthesis" in window) {
    speechSynthesis.onvoiceschanged = findGermanVoice;
    // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø¨Ø¯Ø¡ Ø¨Ø¹Ø¯ Ù‚Ù„ÙŠÙ„
    setTimeout(findGermanVoice, 300);
  } else {
    voiceStatusEl.textContent = "Ø§Ù„Ù†Ø·Ù‚ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… (SpeechSynthesis ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯).";
  }

  // Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ®Ø²ÙŠÙ†
  function loadProgress() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return { completed: {}, wrong: [], last: {moduleIdx:0, lessonIdx:0, itemIdx:0} };
      return JSON.parse(raw);
    } catch (e) {
      console.warn("loadProgress error", e);
      return { completed: {}, wrong: [], last: {moduleIdx:0, lessonIdx:0, itemIdx:0} };
    }
  }
  function saveProgress() {
    try {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(progress));
      updateProgressUI();
    } catch (e) {
      console.warn("saveProgress error", e);
    }
  }
  function resetProgress() {
    if (!confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· ÙƒÙ„ Ø§Ù„ØªÙ‚Ø¯Ù‘Ù…ØŸ")) return;
    progress = { completed: {}, wrong: [], last: {moduleIdx:0, lessonIdx:0, itemIdx:0} };
    currentModuleIdx = 0; currentLessonIdx = 0; currentItemIdx = 0;
    saveProgress();
    renderAll();
    showMessage("ØªÙ…Øª Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„ØªÙ‚Ø¯Ù‘Ù….");
  }

  // ØªØµØ¯ÙŠØ± ÙˆØ§Ø³ØªÙŠØ±Ø§Ø¯
  exportBtn.addEventListener("click", () => {
    const dataStr = JSON.stringify(progress, null, 2);
    const blob = new Blob([dataStr], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url; a.download = "homos_learn_progress.json"; document.body.appendChild(a); a.click();
    a.remove(); URL.revokeObjectURL(url);
  });
  importBtn.addEventListener("click", () => importFile.click());
  importFile.addEventListener("change", (e) => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = () => {
      try {
        const obj = JSON.parse(reader.result);
        if (obj && typeof obj === "object") {
          progress = obj;
          saveProgress();
          renderAll();
          showMessage("ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„ØªÙ‚Ø¯Ù‘Ù… Ø¨Ù†Ø¬Ø§Ø­.");
        } else throw new Error("ØªÙ†Ø³ÙŠÙ‚ ØºÙŠØ± ØµØ­ÙŠØ­");
      } catch (err) {
        alert("ÙØ´Ù„ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ù„Ù: " + err.message);
      }
    };
    reader.readAsText(file);
    importFile.value = "";
  });

  // ÙˆØ§Ø¬Ù‡Ø©: Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª
  function renderModuleList() {
    moduleListEl.innerHTML = "";
    modules.forEach((m, mi) => {
      const div = document.createElement("div");
      div.className = "module-item" + (mi === currentModuleIdx ? " active" : "");
      div.innerHTML = `<div style="text-align:right"><strong>${m.title}</strong><div class="muted" style="font-size:13px">${m.lessons.length} Ø¯Ø±Ø³</div></div>`;
      div.addEventListener("click", () => {
        currentModuleIdx = mi; currentLessonIdx = 0; currentItemIdx = 0;
        progress.last = { moduleIdx: currentModuleIdx, lessonIdx: currentLessonIdx, itemIdx: currentItemIdx };
        saveProgress();
        renderAll();
      });
      moduleListEl.appendChild(div);
    });
  }

  // Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø±ÙˆØ³ Ù„Ù„Ù…ÙˆØ¯ÙŠÙˆÙ„ Ø§Ù„Ø­Ø§Ù„ÙŠ
  function renderLessonList() {
    lessonListEl.innerHTML = "";
    const lessons = modules[currentModuleIdx].lessons;
    lessons.forEach((ls, li) => {
      const liEl = document.createElement("li");
      liEl.className = (li === currentLessonIdx ? "active" : "");
      liEl.innerHTML = `<div style="text-align:right"><div class="title-small">${ls.title}</div><div class="meta">${ls.desc}</div></div>
                        <div>${progress.completed[ls.id] ? '<span class="completed-badge">Ù…ÙƒØªÙ…Ù„</span>' : ''}</div>`;
      liEl.addEventListener("click", () => {
        currentLessonIdx = li; currentItemIdx = 0;
        progress.last = { moduleIdx: currentModuleIdx, lessonIdx: currentLessonIdx, itemIdx: currentItemIdx };
        saveProgress();
        renderAll();
      });
      lessonListEl.appendChild(liEl);
    });
  }

  // Ø¹Ø±Ø¶ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¯Ø±Ø³
  function renderLessonContent() {
    const lesson = modules[currentModuleIdx].lessons[currentLessonIdx];
    lessonTitleEl.textContent = lesson.title;
    lessonDescEl.textContent = lesson.desc;
    itemsContainerEl.innerHTML = "";

    lesson.items.forEach((it, ii) => {
      const itemDiv = document.createElement("div");
      itemDiv.className = "item";
      itemDiv.innerHTML = `
        <div class="left">
          <div class="de">${it.de}</div>
          <div class="ar">${it.ar}</div>
        </div>
        <div class="controls">
          <button class="play-btn small" data-idx="${ii}">ğŸ”Š Ù†Ø·Ù‚</button>
          <button class="play-btn small record-btn" data-idx="${ii}">ğŸ¤ Ø¬Ø±Ù‘Ø¨ Ù†Ø·Ù‚Ùƒ</button>
        </div>
      `;
      // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø£Ø²Ø±Ø§Ø±
      const playBtn = itemDiv.querySelector(".play-btn");
      playBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        speakText(it.de);
      });
      const recordBtn = itemDiv.querySelector(".record-btn");
      recordBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        recordPlaybackExample(it.de);
      });

      itemsContainerEl.appendChild(itemDiv);
    });

    // Ø¶Ø¨Ø· Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„
    prevBtn.disabled = currentLessonIdx === 0;
    nextBtn.disabled = currentLessonIdx === modules[currentModuleIdx].lessons.length - 1;

    // Ø­Ø§Ù„Ø© Ø§Ù„Ø¯Ø±Ø³ Ù…ÙƒØªÙ…Ù„
    markCompleteBtn.textContent = progress.completed[lesson.id] ? "Ù…ÙƒØªÙ…Ù„ âœ…" : "ÙˆØ¶Ø¹ Ø¹Ù„Ø§Ù…Ø© Ù…ÙƒØªÙ…Ù„ âœ…";
    updateProgressUI();
  }

  // Ù†Ø·Ù‚ Ø¢Ù…Ù†
  function speakText(text) {
    if (!("speechSynthesis" in window)) {
      showMessage("Ø§Ù„Ù†Ø·Ù‚ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… ÙÙŠ Ù…ØªØµÙØ­Ùƒ. Ø§Ø³ØªØ®Ø¯Ù… Chrome Ø£Ùˆ Firefox.", 3000);
      return;
    }
    try {
      speechSynthesis.cancel();
      const u = new SpeechSynthesisUtterance(text);
      u.lang = "de-DE";
      u.rate = 0.95;
      if (germanVoice) u.voice = germanVoice;
      speechSynthesis.speak(u);
    } catch (e) {
      console.error("speakText error", e);
      showMessage("ØªØ¹Ø°Ø± ØªØ´ØºÙŠÙ„ Ø§Ù„Ù†Ø·Ù‚.", 2000);
    }
  }

  // ØªØ´ØºÙŠÙ„ ÙƒÙ„ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¯Ø±Ø³ Ø¨Ø§Ù„ØªØªØ§Ø¨Ø¹
  playAllBtn.addEventListener("click", async () => {
    const lesson = modules[currentModuleIdx].lessons[currentLessonIdx];
    for (let it of lesson.items) {
      speakText(it.de);
      // Ù†Ù†ØªØ¸Ø± 900-1200 Ù…Ù„Ù‘ÙŠ Ø«Ø§Ù†ÙŠØ© Ø¨ÙŠÙ† Ø§Ù„ÙƒÙ„Ù…Ø§Øª
      await new Promise(r => setTimeout(r, 900));
    }
  });

  // ØªØ³Ø¬ÙŠÙ„ ØµÙˆØªÙŠ Ù…Ø¤Ù‚Øª ÙˆØªØ´ØºÙŠÙ„Ù‡
  async function recordPlaybackExample(expectedText) {
    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
      showMessage("Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­/Ø§Ù„Ø¬Ù‡Ø§Ø².", 3000);
      return;
    }
    try {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      const mr = new MediaRecorder(stream);
      const chunks = [];
      showMessage("Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙŠØ¨Ø¯Ø£ Ø§Ù„Ø¢Ù† â€” ØªØ­Ø¯Ø« Ø§Ù„ÙƒÙ„Ù…Ø© Ø£Ùˆ Ø§Ù„Ø¬Ù…Ù„Ø© Ø¨ØµÙˆØª ÙˆØ§Ø¶Ø­ (2.5 Ø«Ø§Ù†ÙŠØ©) ...", 3000);
      mr.ondataavailable = e => chunks.push(e.data);
      mr.onstop = () => {
        const blob = new Blob(chunks, { type: "audio/webm" });
        const url = URL.createObjectURL(blob);
        const audio = document.createElement("audio");
        audio.controls = true;
        audio.src = url;
        audio.style.marginTop = "8px";
        messageEl.innerHTML = `Ø§Ø³ØªÙ…Ø¹ Ù„ØªØ³Ø¬ÙŠÙ„Ùƒ: <br>`;
        messageEl.appendChild(audio);
        stream.getTracks().forEach(t => t.stop());
      };
      mr.start();
      setTimeout(() => { if (mr.state !== "inactive") mr.stop(); }, 2500);
    } catch (err) {
      console.error(err);
      showMessage("ØªØ¹Ø°Ø± Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ† Ø£Ùˆ Ø±ÙØ¶Øª Ø§Ù„Ø¥Ø°Ù†.", 3000);
    }
  }

  // ÙˆØ³Ù… Ø§Ù„Ø¯Ø±Ø³ ÙƒÙ…ÙƒØªÙ…Ù„
  markCompleteBtn.addEventListener("click", () => {
    const lesson = modules[currentModuleIdx].lessons[currentLessonIdx];
    progress.completed[lesson.id] = true;
    progress.last = { moduleIdx: currentModuleIdx, lessonIdx: currentLessonIdx, itemIdx: currentItemIdx };
    saveProgress();
    renderAll();
    showMessage("ØªÙ… ÙˆØ¶Ø¹ Ø¹Ù„Ø§Ù…Ø© Ø¥ØªÙ…Ø§Ù… Ø¹Ù„Ù‰ Ø§Ù„Ø¯Ø±Ø³ âœ…", 2000);
  });

  // Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ (spaced repetition Ø¨Ø³ÙŠØ·Ø©)
  reviewWrongBtn.addEventListener("click", () => {
    if (!progress.wrong || progress.wrong.length === 0) {
      alert("Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙ„Ù…Ø§Øª Ø®Ø§Ø·Ø¦Ø© Ø§Ù„Ø¢Ù† â€” Ø­Ø³Ù‘Ù† Ù…Ø­Ø§ÙˆÙ„Ø§ØªÙƒ ÙˆØ³ÙŠÙØ³Ø¬Ù„ Ø§Ù„Ø®Ø·Ø£ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©.");
      return;
    }
    // Ù†Ø¹Ø±Ø¶ Ù†Ø§ÙØ°Ø© Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø®ØµÙ‘ØµØ© Ù„Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø®Ø§Ø·Ø¦Ø©
    openQuizModal(true);
  });

  // Ø²Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¶Ø¨Ø·
  resetBtn.addEventListener("click", resetProgress);

  // Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„Ø¯Ø±ÙˆØ³
  prevBtn.addEventListener("click", () => {
    if (currentLessonIdx > 0) currentLessonIdx--;
    progress.last = { moduleIdx: currentModuleIdx, lessonIdx: currentLessonIdx, itemIdx: 0 };
    saveProgress();
    renderAll();
  });
  nextBtn.addEventListener("click", () => {
    if (currentLessonIdx < modules[currentModuleIdx].lessons.length - 1) currentLessonIdx++;
    progress.last = { moduleIdx: currentModuleIdx, lessonIdx: currentLessonIdx, itemIdx: 0 };
    saveProgress();
    renderAll();
  });

  // ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
  quizBtn.addEventListener("click", () => openQuizModal(false));
  function openQuizModal(onlyWrong = false) {
    quizModal.setAttribute("aria-hidden", "false");
    quizArea.innerHTML = "";
    if (onlyWrong) {
      quizArea.innerHTML = `<p class="muted">Ø§Ø®ØªØ¨Ø§Ø± ÙƒÙ„Ù…Ø§Øª Ø®Ø§Ø·Ø¦Ø© (${progress.wrong.length})</p><div id="quizContainerWrong"></div>`;
      buildQuizFromWrong();
    } else {
      quizArea.innerHTML = `<p class="muted">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ø­Ø§Ù„ÙŠ</p><div id="quizContainer"></div>`;
      buildQuizForCurrentLesson();
    }
  }
  closeQuizBtn.addEventListener("click", () => { quizModal.setAttribute("aria-hidden", "true"); quizArea.innerHTML = ""; });
  startQuizBtn && startQuizBtn.addEventListener("click", () => {
    // Ù„Ø§ Ø­Ø§Ø¬Ø© Ù‡Ù†Ø§ Ù„Ø£Ù† Ø§Ù„Ø¨Ù†ÙŠØ© ØªØ¨Ù†Ù‰ ÙÙˆØ± Ø§Ù„ÙØªØ­
  });

  // Ø¨Ù†Ø§Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ù„Ù„Ø¯Ø±Ø³ Ø§Ù„Ø­Ø§Ù„ÙŠ
  function buildQuizForCurrentLesson() {
    const lesson = modules[currentModuleIdx].lessons[currentLessonIdx];
    const container = document.getElementById("quizContainer");
    container.innerHTML = "";
    // Ù†ÙˆÙ„Ø¯ 5 Ø£Ø³Ø¦Ù„Ø© Ø£Ùˆ Ø£Ù‚Ù„ Ø¨Ù†Ø§Ø¡ Ø¹Ù„Ù‰ Ø­Ø¬Ù… Ø§Ù„Ø¯Ø±Ø³
    const pool = [...lesson.items];
    shuffle(pool);
    const qCount = Math.min(5, pool.length);
    for (let i = 0; i < qCount; i++) {
      const item = pool[i];
      const qDiv = document.createElement("div");
      qDiv.className = "quiz-q";
      const options = [item.ar];
      // Ù†Ø£Ø®Ø° 3 Ù…Ø´ØªØªØ§Øª Ù…Ù† Ø¨Ù‚ÙŠØ© Ø§Ù„Ø¹Ù†Ø§ØµØ±
      const distractors = lesson.items.filter(x => x.ar !== item.ar).slice(0);
      shuffle(distractors);
      for (let j = 0; j < Math.min(3, distractors.length); j++) options.push(distractors[j].ar);
      shuffle(options);
      qDiv.innerHTML = `<div style="text-align:right;margin-bottom:6px"><strong>Ù…Ø§ Ù…Ø¹Ù†Ù‰:</strong> <span style="font-weight:800">${item.de}</span></div>`;
      options.forEach(opt => {
        const b = document.createElement("button");
        b.className = "btn ghost";
        b.textContent = opt;
        b.addEventListener("click", () => {
          if (opt === item.ar) {
            b.style.background = "#e6f8ef"; b.style.border = "1px solid #bfe6c9";
            showMessage("Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø© âœ“", 1200);
          } else {
            b.style.background = "#ffe6e6";
            // Ø³Ø¬Ù„ Ø§Ù„Ø®Ø·Ø£
            if (!progress.wrong.includes(item.de)) progress.wrong.push(item.de);
            saveProgress();
            showMessage(`Ø®Ø·Ø£ â€” Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©: ${item.ar}`, 1800);
          }
        });
        qDiv.appendChild(b);
      });
      container.appendChild(qDiv);
    }
  }

  // Ø¨Ù†Ø§Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ù…Ù† Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø®Ø§Ø·Ø¦Ø©
  function buildQuizFromWrong() {
    const container = document.getElementById("quizContainerWrong");
    container.innerHTML = "";
    if (!progress.wrong || progress.wrong.length === 0) { container.innerHTML = "<p>Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙ„Ù…Ø§Øª Ø®Ø§Ø·Ø¦Ø©.</p>"; return; }
    const pool = [...progress.wrong];
    shuffle(pool);
    pool.slice(0, Math.min(8, pool.length)).forEach(deWord => {
      // Ù†Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ØªØ±Ø¬Ù…Ø© Ø¯Ø§Ø®Ù„ modules
      const found = findItemByDE(deWord);
      const ar = found ? found.ar : "(ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ØªØ±Ø¬Ù…Ø©)";
      const qDiv = document.createElement("div");
      qDiv.className = "quiz-q";
      qDiv.innerHTML = `<div style="text-align:right;margin-bottom:6px"><strong>Ù…Ø§ Ù…Ø¹Ù†Ù‰:</strong> <span style="font-weight:800">${deWord}</span></div>
                        <div style="margin-bottom:8px"><em>${ar}</em></div>
                        <div style="display:flex;gap:8px;justify-content:flex-end">
                          <button class="btn" onclick="removeWrong('${escapeForAttr(deWord)}')">Ø£Ø²Ù„ Ù…Ù† Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</button>
                        </div>`;
      container.appendChild(qDiv);
    });
  }

  // Ø¥Ø²Ø§Ù„Ø© ÙƒÙ„Ù…Ø© Ù…Ù† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
  window.removeWrong = function(deWordEscaped) {
    const deWord = deWordEscaped;
    progress.wrong = progress.wrong.filter(w => w !== deWord);
    saveProgress();
    buildQuizFromWrong();
    showMessage("Ø£Ø²ÙŠÙ„Øª Ø§Ù„ÙƒÙ„Ù…Ø© Ù…Ù† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡.", 1500);
  };

  // Ù…Ø³Ø§Ø¹Ø¯Ø©: Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† ØªØ±Ø¬Ù…Ø© Ø­Ø³Ø¨ ÙƒÙ„Ù…Ø© Ø£Ù„Ù…Ø§Ù†ÙŠØ©
  function findItemByDE(de) {
    for (let m of modules) {
      for (let l of m.lessons) {
        for (let it of l.items) {
          if (it.de === de) return it;
        }
      }
    }
    return null;
  }

  // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø¹Ù†Ø¯ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ø®Ø§Ø·Ø¦Ø© ÙÙŠ Ø£ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø¢Ø®Ø±
  function addWrong(de) {
    if (!progress.wrong.includes(de)) {
      progress.wrong.push(de);
      saveProgress();
    }
  }

  // Ù…Ø³Ø§Ø¹Ø¯Ø§Øª
  function showMessage(txt, timeout = 0) {
    messageEl.textContent = txt;
    if (timeout > 0) setTimeout(() => { if (messageEl.textContent === txt) messageEl.textContent = ""; }, timeout);
  }

  function updateProgressUI() {
    const totalLessons = modules.reduce((s, m) => s + m.lessons.length, 0);
    const completedCount = Object.keys(progress.completed || {}).length;
    progressSummaryEl.textContent = `Ø§Ù„Ø¯Ø±ÙˆØ³ Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©: ${completedCount} / ${totalLessons} â€” ÙƒÙ„Ù…Ø§Øª Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©: ${progress.wrong.length}`;
    // Ø¥Ø¹Ø§Ø¯Ø© Ø±Ø³Ù… Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø±ÙˆØ³ Ù„Ø¹Ø±Ø¶ badge
    renderLessonList();
  }

  // Ù…Ø³Ø§Ø¹Ø¯Ø©: Ø®Ù„Ø·
  function shuffle(a) {
    for (let i = a.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
  }

  // ÙˆØ¸Ø§Ø¦Ù Ø¹Ø±Ø¶ ÙƒØ§Ù…Ù„Ø©
  function renderAll() {
    renderModuleList();
    renderLessonList();
    renderLessonContent();
  }

  // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©: Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø¢Ø®Ø± Ø­Ø§Ù„Ø©
  if (progress && progress.last) {
    currentModuleIdx = progress.last.moduleIdx || 0;
    currentLessonIdx = progress.last.lessonIdx || 0;
    currentItemIdx = progress.last.itemIdx || 0;
  }
  renderAll();

  // Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø®Ø±ÙˆØ¬
  window.addEventListener("beforeunload", () => saveProgress());

  // ØªÙ‡ÙŠØ¦Ø© Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
  // Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ø¨Ø§Ù„ÙØ¹Ù„ØŒ ÙŠØªÙ… Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù…Ø­ØªÙˆÙ‰Ø› Ù„Ø°Ù„Ùƒ startQuizBtn ØºÙŠØ± Ù…Ø·Ù„ÙˆØ¨ Ù‡Ù†Ø§.
  // Ø£ØºÙ„Ù‚ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬ Ø§Ù„Ù…Ø­ØªÙˆÙ‰
  quizModal.addEventListener("click", (e) => {
    if (e.target === quizModal) {
      quizModal.setAttribute("aria-hidden", "true");
      quizArea.innerHTML = "";
    }
  });

  // Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙÙˆØ± ÙØªØ­ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ (Ù‡Ù†Ø§Ùƒ Ø²Ø± startQuiz Ù„ÙƒÙ†Ù‡ ØºÙŠØ± Ø¶Ø±ÙˆØ±ÙŠ)
  // Ù„ÙƒÙ† Ù†Ø­ØªØ§Ø¬ Ø±Ø¨Ø· closeQuizBtn Ùˆ startQuizBtn Ø¥Ù† ÙˆÙØ¬Ø¯Øª
  if (closeQuizBtn) closeQuizBtn.addEventListener("click", () => { quizModal.setAttribute("aria-hidden", "true"); quizArea.innerHTML = ""; });

  // Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø¯Ù‘Ù… Ø¹Ù„Ù‰ Ø§Ù„ÙÙˆØ±
  saveProgress();

  // >>> Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„ØªØ¹Ø±ÙŠÙØ§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© <<<

  // Ù…Ù„Ø§Ø­Ø¸Ø©: Ù„Ø§ Ù†Ø³ØªØ¯Ø¹ÙŠ speechSynthesis Ù…Ø¨Ø§Ø´Ø±Ø© Ø¯ÙˆÙ† ØªØ­Ù‚Ù‚Ø› Ø§Ø³ØªØ®Ø¯Ù… speakText() Ø§Ù„Ø¢Ù…Ù†Ø©.

});</script></body></html>